start: woods:entrance
tag_engine:
  tags:
    woods:entrance:item:sword: !Number 1.0
state_machine:
  world:
    states:
      ephemeral:shop:
        location: ephemeral:shop
        scene:
          descriptions:
          - descriptor: The shop is cozy, and staffed by a weathered crone
          - predicate: !Tag
            - player:item:sword
            - !Number 1.0
            descriptor: Her eyes keep flitting to the sword at your side
        choices:
        - description:
            descriptor: Leave the shop
          effect:
            next: Pop
            actions: []
        - description:
            predicate: !Tag
            - player:item:sword
            - !Number 1.0
            descriptor: Trade a sword for two swords
          effect:
            next: None
            actions:
            - !Subtract
              - player:item:sword
              - !Number 1.0
            - !Add
              - player:item:sword
              - !Number 2.0
        - description:
            predicate: !Tag
            - player:item:sword
            - !Number 1.0
            descriptor: Trade each sword for two swords
          effect:
            next: None
            actions:
            - !Multiply
              - player:item:sword
              - !Number 2.0
        - description:
            predicate: !Tag
            - player:item:sword
            - !Number 2.0
            descriptor: Forge two swords into a cursed ring
          effect:
            next: None
            actions:
            - !Subtract
              - player:item:sword
              - !Number 2.0
            - !Add
              - player:item:cursed-ring
              - !Number 1.0
        - description:
            predicate: !Tag
            - player:item:sword
            - !Number 2.0
            descriptor: Forge every other sword into a cursed ring
          effect:
            next: None
            actions:
            - !Divide
              - player:item:sword
              - !Number 2.0
            - !Add
              - player:item:cursed-ring
              - !Tag player:item:sword
      woods:depths:
        location: woods:depths
        scene:
          descriptions:
          - descriptor: You are lost in the woods
        choices:
        - description:
            descriptor: Go deeper into the woods
          effect:
            next: !Swap woods:depths
            actions: []
      woods:entrance:
        location: woods:entrance
        scene:
          descriptions:
          - descriptor: You are in the woods
          - descriptor: There is a mysterious moss-covered shop in a small grove
          - predicate: !Tag
            - woods:entrance:item:sword
            - !Number 1.0
            descriptor: You see a shiny sword lodged in a stone
        choices:
        - description:
            predicate: !Tag
            - woods:entrance:item:sword
            - !Number 1.0
            descriptor: Pick up the sword
          effect:
            next: None
            actions:
            - !Insert
              - player:item:sword
              - !Number 1.0
            - !Remove
              - woods:entrance:item:sword
              - !Number 1.0
        - description:
            descriptor: Go into the shop
          effect:
            next: !Push ephemeral:shop
            actions: []
        - description:
            descriptor: Go deeper into the woods
          effect:
            next: !Swap woods:depths
            actions: []
  current: []
